<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://js.stripe.com https://m.stripe.network; style-src 'self' 'unsafe-inline' https://m.stripe.network; frame-src 'self' https://js.stripe.com https://m.stripe.network; connect-src 'self' https://api.stripe.com https://m.stripe.network https://api.infusionsoft.com; img-src 'self' data: https:;">
    <title>Destiny Cards - Limited Edition Pre-Order</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://js.stripe.com/v3/"></script>
</head>
<body>
        <div class="header">
            <h1>Destiny Cards</h1>
            <p class="tagline">The Paradox Process in Your Hands</p>
            <p class="subtitle">Limited Edition • 1st Printing • Only 75 Decks Available</p>
        </div>

        <div class="hero-section">
            <h2>What if the next time you're stuck, you had a tool that could shift your entire perspective in minutes?</h2>
            <p>You know that feeling. You're caught in a loop—replaying the same relationship argument, staring at the same career dead-end, feeling the same anxiety about money. Your mind tells the same story on repeat, and you can't seem to find your way out.</p>
            <p class="emphasis">Destiny Cards give you a way out.</p>
            <p>This limited-edition deck puts the power of the Paradox Process directly in your hands. No classes. No sessions. No waiting. Just you, the cards, and a new way of seeing what's in front of you.</p>
        </div>

        <div class="products-section">

            <div class="section-intro">
                <h2>Get your Limited Edition Deck Now!</h2>
                <p>Only 75 available.</p>
            </div>

            <div class="product-grid">
                <div class="product-option" data-product="cards-only" data-price="20">
                    <div class="badge">Limited Quantity</div>
                    <div class="product-image">
                        <img src="cards.png" alt="Destiny Cards Deck">
                    </div>
                    <div class="product-info">
                        <h3>Destiny Cards</h3>
                        <div class="price">$20</div>
                        <ul class="features">
                            <li>Complete 1st Edition Destiny Cards deck</li>
                            <li>25+ Functional Philosophy cards</li>
                            <li>10+ Resourceful State cards</li>
                            <li>Quick-start instruction guide</li>
                            <li>Limited edition collector's item</li>
                        </ul>
                        <div class="product-selector">
                            <button class="add-to-cart-button" data-product="cards-only">Add To Cart</button>
                            <div class="quantity-selector hidden" data-product="cards-only">
                                <button class="quantity-btn minus">−</button>
                                <span class="quantity-display">1</span>
                                <button class="quantity-btn plus">+</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="product-option" data-product="cards-book-bundle" data-price="60">
                    <div class="badge">Pre-Order Bundle</div>
                    <div class="product-image">
                        <img src="cards.png" alt="Destiny Cards + Rules To Live By Bundle">
                    </div>
                    <div class="product-info">
                        <h3>Destiny Cards + Rules To Live By (But Not Believe) Pre-Order</h3>
                        <div class="price">$60</div>
                        <ul class="features">
                            <li>Complete 1st Edition Destiny Cards deck</li>
                            <li>25+ Functional Philosophy cards</li>
                            <li>10+ Resourceful State cards</li>
                            <li>Quick-start instruction guide</li>
                            <li>"Rules To Live By (But Not Believe)" book pre-order</li>
                            <li>The perfect companion to deepen your practice</li>
                        </ul>
                        <div class="shipping-notice">
                            <strong>Note:</strong> Items ship separately. Destiny Cards ship now. Book ships March 2025.
                        </div>
                        <div class="product-selector">
                            <button class="add-to-cart-button" data-product="cards-book-bundle">Add To Cart</button>
                            <div class="quantity-selector hidden" data-product="cards-book-bundle">
                                <button class="quantity-btn minus">−</button>
                                <span class="quantity-display">1</span>
                                <button class="quantity-btn plus">+</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="content-section">
            <h2>Two Types of Cards. One Powerful System.</h2>
            <p><strong>Functional Philosophy Cards</strong> offer you 25+ viewpoints that cut through your stuck stories and reveal what you haven't been able to see. These aren't affirmations. They're lenses, ways of looking at your situation that create actual shifts in how you feel and what becomes possible.</p>
            <p><strong>Resourceful State Cards</strong> give you access to the emotional clarity you need to make those shifts real. States like empathy, confidence, gratitude, and courage that move you from fight-flight-freeze into rest-receive-allow.</p>
            <p class="emphasis">When you combine them? You get the worksite. The place where real change happens.</p>
        </div>

        <div class="how-it-works">
            <h2>How It Works:</h2>
            <p class="intro">It's simple. Deceptively simple.</p>
            <ol>
                <li>Identify the issue that's got you stuck</li>
                <li>Pull a Destiny Card</li>
                <li>Pull a Resourceful State Card</li>
                <li>Look at your situation through both lenses</li>
                <li>Notice what shifts</li>
            </ol>
            <p>That's it. No belief required. Just willingness.</p>
            <p>You're not being asked to adopt a new worldview or convince yourself of anything. You're simply using a tool—the same way engineers use imaginary numbers to solve real problems. These cards work whether you believe in them or not.</p>
        </div>

        <div class="differentiation">
            <h2>This Isn't Like Other Card Decks</h2>
            <p>Most oracle or affirmation decks give you pretty words that make you feel good for five minutes. Then you're right back where you started. <span class="emphasis">Destiny Cards are different.</span></p>
            <p>They're built on the Paradox Process. A methodology with over 40 years of proven results with CEOs, award-winning performers, psychologists, and people just like you who were tired of being stuck.</p>
            <p>These cards don't just comfort you. They challenge you. They show you the point of resistance where actual transformation lives and they give you the resourceful state you need to work through it.</p>
        </div>

        <div class="limited-edition-banner">
            <h2>Limited Edition. 1st Edition. Only 75 Decks Available.</h2>
            <p>This is the first printing of Destiny Cards, and we're keeping it small. Once these 75 decks are gone, they're gone.</p>
            <p>Why so few? Because this isn't about mass production. It's about getting a powerful tool into the hands of people who will actually use it. People who are serious about getting out of their own way.</p>
            <p class="emphasis">If you've been doing the work or you're ready to start, this deck belongs with you.</p>
        </div>

        <div class="who-this-is-for">
            <h2>Destiny Cards Are For You If...</h2>
            <ul>
                <li>You're tired of your negative feelings running the show</li>
                <li>You've been stuck on the same issue for too long</li>
                <li>You want a tool that actually works, not just another pretty affirmation</li>
                <li>You're willing to look at your life differently</li>
                <li>You're ready to get out of your own way</li>
                <li>You're already familiar with the Paradox Process (or curious to dive in)</li>
            </ul>
            <p class="emphasis">This deck isn't for everyone. It's for people who want real change, not just temporary relief.</p>
        </div>

        <div class="promise-section">
            <h2>The Paradox Process Promise</h2>
            <p>The mind isn't fixed. The beliefs you have now? They were programmed since childhood to protect a version of you that no longer exists. Those outdated protections are keeping you from the very things you want.</p>
            <p>Destiny Cards give you a way to interrupt those patterns and install new ones. Not through force. Not through repetition. But through perspective shifts that hit at the subconscious level.</p>
            <p class="emphasis">That's what makes the Paradox Process different. And that's why this deck works.</p>
        </div>

        <div class="testimonials">
            <h2>What People Are Saying</h2>
            <div class="testimonial-grid">
                <div class="testimonial">
                    <p class="testimonial-text">[Testimonial will be added here]</p>
                    <p class="testimonial-author">— Coming Soon</p>
                </div>
                <div class="testimonial">
                    <p class="testimonial-text">[Testimonial will be added here]</p>
                    <p class="testimonial-author">— Coming Soon</p>
                </div>
                <div class="testimonial">
                    <p class="testimonial-text">[Testimonial will be added here]</p>
                    <p class="testimonial-author">— Coming Soon</p>
                </div>
            </div>
        </div>
        
        <div class="truth-section">
            <h2>The Truth About Tools</h2>
            <p>You don't have to believe imaginary numbers exist to use them to build bridges and design technology. You just have to be willing to use the tool.</p>
            <p>Destiny Cards work the same way.</p>
            <p>You don't have to believe every philosophy. You don't have to adopt every viewpoint. You just have to be willing to look through the lens and see what shifts.</p>
            <p class="emphasis">That willingness? That's all it takes.</p>
            <p>The question isn't whether this deck can help you. The question is: are you willing to get out of your own way?</p>
            <p class="final-cta"><strong>Only 75 available. Get yours before they're gone.</strong></p>
        </div>

        <div class="footer">
            <p><em>Created by Thomas M. Jones, founder of The Paradox Process. With over 40 years of experience guiding CEOs, award-winning performers, and change-makers toward their dreams, Thomas brings practical tools for transformation that actually work.</em></p>
        </div>

        <!-- Modal Overlay for Checkout -->
        <div class="modal-overlay" id="checkout-modal">
            <div class="modal-container">
                <div class="modal-header">
                    <h2>Complete Your Order</h2>
                    <button class="modal-close" id="close-modal" aria-label="Close modal">×</button>
                </div>
                <div class="modal-body">
                    <!-- Step 1: Order Summary & Email -->
                    <div id="checkout-step-email" class="checkout-step">
                        <div class="order-summary-section">
                            <h3>Order Summary</h3>
                            <div id="modal-order-items"></div>
                            <div class="order-summary-totals">
                                <div class="summary-row">
                                    <span>Subtotal:</span>
                                    <span id="modal-subtotal">$0</span>
                                </div>
                                <div class="summary-row">
                                    <span>Shipping:</span>
                                    <span id="modal-shipping">Calculated at next step</span>
                                </div>
                            </div>
                        </div>

                        <div class="email-section">
                            <div class="form-group">
                                <label for="customer-email">Email Address</label>
                                <input type="email" id="customer-email" name="email" placeholder="your@email.com">
                                <small>Order confirmation will be sent to this email</small>
                            </div>
                            <div class="consent-group">
                                <input type="checkbox" id="email-consent" name="emailConsent" checked>
                                <label for="email-consent">
                                    I agree to receive email updates about my order and future offerings from The Paradox Process. You can unsubscribe at any time.
                                </label>
                            </div>
                        </div>

                        <button type="button" id="proceed-to-payment" class="checkout-button">
                            Proceed to Payment
                        </button>
                    </div>

                    <!-- Step 2: Stripe Embedded Checkout -->
                    <div id="checkout-step-payment" class="checkout-step hidden">
                        <div id="checkout-loading" class="checkout-loading">
                            <div class="loading-spinner"></div>
                            <p>Loading secure checkout...</p>
                        </div>
                        <div id="stripe-checkout-container"></div>
                    </div>

                    <div class="error-message" id="checkout-errors"></div>
                </div>
            </div>
        </div>

    <!-- Sticky Bottom Checkout Bar -->
    <div class="bottom-checkout-bar" id="bottom-checkout-bar">
        <div class="checkout-bar-content">
            <div class="checkout-bar-info">
                <div class="checkout-bar-product">
                    <span class="checkout-bar-product-name" id="bar-product-name">Destiny Cards</span>
                    <span class="checkout-bar-product-price" id="bar-product-price">1 × $20</span>
                </div>
                <div class="checkout-bar-shipping">
                    <span class="checkout-bar-shipping-label">Shipping:</span>
                    <span class="checkout-bar-shipping-cost" id="bar-shipping-cost">$5</span>
                </div>
                <div class="checkout-bar-total">
                    <span class="checkout-bar-total-label">Total:</span>
                    <span class="checkout-bar-total-amount" id="bar-total-amount">$25</span>
                </div>
            </div>
            <button class="checkout-bar-button" id="bar-checkout-button">
                Proceed to Checkout
            </button>
        </div>
    </div>
    <script>
        // ============================================
        // PRODUCT CONFIGURATION
        // ============================================

        const PRODUCTS = {
            'cards-only': {
                name: 'Destiny Cards',
                price: 20,
                description: 'Complete 1st Edition Destiny Cards deck',
                shipsNow: true
            },
            'cards-book-bundle': {
                name: 'Destiny Cards + Rules To Live By Pre-Order',
                price: 60,
                description: 'Destiny Cards deck + Rules To Live By (But Not Believe) book pre-order',
                shipsNow: false,
                splitShipment: true,
                shipmentNotes: 'Destiny Cards ship now. Book ships March 2025.'
            }
        };

        const productQuantities = {
            'cards-only': 0,
            'cards-book-bundle': 0
        };

        // Stripe publishable key
        const STRIPE_PUBLIC_KEY = 'pk_test_51S9vybJaTakfgkML3IMec5kLbEDf2K4V5A05cKItlGe8sNggczJwdaKe4JmI9f2RXGI1jlT6GD467vJyYFciSKxC00CLjz8vcM';

        // Initialize Stripe
        let stripe;
        if (STRIPE_PUBLIC_KEY !== 'pk_test_YOUR_STRIPE_KEY_HERE') {
            stripe = Stripe(STRIPE_PUBLIC_KEY);
        }

        // ============================================
        // MODAL FUNCTIONALITY
        // ============================================

        const modal = document.getElementById('checkout-modal');
        const closeModalBtn = document.getElementById('close-modal');
        const barCheckoutButton = document.getElementById('bar-checkout-button');
        let currentCheckout = null;

        function openModal() {
            // Reset to email step
            showCheckoutStep('email');
            updateModalOrderSummary();
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeModal() {
            modal.classList.remove('active');
            document.body.style.overflow = '';
            // Clean up any existing checkout
            if (currentCheckout) {
                currentCheckout.destroy();
                currentCheckout = null;
            }
        }

        function showCheckoutStep(step) {
            document.getElementById('checkout-step-email').classList.toggle('hidden', step !== 'email');
            document.getElementById('checkout-step-payment').classList.toggle('hidden', step !== 'payment');
        }

        barCheckoutButton.addEventListener('click', openModal);
        closeModalBtn.addEventListener('click', closeModal);
        modal.addEventListener('click', (e) => {
            if (e.target === modal) closeModal();
        });
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && modal.classList.contains('active')) closeModal();
        });

        // ============================================
        // ORDER SUMMARY IN MODAL
        // ============================================

        function updateModalOrderSummary() {
            const itemsContainer = document.getElementById('modal-order-items');
            const subtotalEl = document.getElementById('modal-subtotal');

            let html = '';
            let subtotal = 0;

            for (const [productId, quantity] of Object.entries(productQuantities)) {
                if (quantity > 0) {
                    const product = PRODUCTS[productId];
                    const lineTotal = product.price * quantity;
                    subtotal += lineTotal;

                    html += `
                        <div class="order-item">
                            <div class="order-item-details">
                                <span class="order-item-name">${product.name}</span>
                                <span class="order-item-qty">Qty: ${quantity}</span>
                            </div>
                            <span class="order-item-price">$${lineTotal}</span>
                        </div>
                    `;

                    if (product.splitShipment) {
                        html += `<div class="order-item-note">Ships separately: Cards now, Book March 2025</div>`;
                    }
                }
            }

            itemsContainer.innerHTML = html;
            subtotalEl.textContent = `$${subtotal}`;
        }

        // ============================================
        // STRIPE EMBEDDED CHECKOUT
        // ============================================

        document.getElementById('proceed-to-payment').addEventListener('click', async () => {
            const totalQuantity = getTotalQuantity();
            if (totalQuantity === 0) {
                showError('Please add items to your cart.');
                return;
            }

            const customerEmail = document.getElementById('customer-email').value;
            const emailConsent = document.getElementById('email-consent').checked;

            // Show payment step with loading
            showCheckoutStep('payment');
            document.getElementById('checkout-loading').style.display = 'flex';
            document.getElementById('stripe-checkout-container').innerHTML = '';

            // Build cart items
            const cartItems = [];
            for (const [productId, quantity] of Object.entries(productQuantities)) {
                if (quantity > 0) {
                    const product = PRODUCTS[productId];
                    cartItems.push({
                        productId,
                        productName: product.name,
                        productPrice: product.price,
                        quantity,
                        shipsNow: product.shipsNow,
                        splitShipment: product.splitShipment || false
                    });
                }
            }

            try {
                // Create checkout session
                const response = await fetch('/.netlify/functions/create-checkout-session', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        cartItems,
                        customerEmail,
                        emailConsent
                    })
                });

                const { clientSecret, error } = await response.json();

                if (error) {
                    throw new Error(error);
                }

                // Hide loading
                document.getElementById('checkout-loading').style.display = 'none';

                // Mount embedded checkout
                currentCheckout = await stripe.initEmbeddedCheckout({
                    clientSecret
                });

                currentCheckout.mount('#stripe-checkout-container');

            } catch (error) {
                console.error('Checkout error:', error);
                showError(error.message || 'Failed to load checkout. Please try again.');
                showCheckoutStep('email');
            }
        });

        function showError(message) {
            const errorEl = document.getElementById('checkout-errors');
            errorEl.textContent = message;
            errorEl.style.display = 'block';
            setTimeout(() => {
                errorEl.style.display = 'none';
            }, 5000);
        }

        // ============================================
        // QUANTITY SELECTOR FUNCTIONALITY
        // ============================================

        document.querySelectorAll('.add-to-cart-button').forEach(button => {
            button.addEventListener('click', (e) => {
                e.stopPropagation();
                addToCart(button.dataset.product);
            });
        });

        document.querySelectorAll('.quantity-btn').forEach(button => {
            button.addEventListener('click', (e) => {
                e.stopPropagation();
                const productId = button.closest('.quantity-selector').dataset.product;
                if (button.classList.contains('plus')) {
                    increaseQuantity(productId);
                } else if (button.classList.contains('minus')) {
                    decreaseQuantity(productId);
                }
            });
        });

        function addToCart(productId) {
            productQuantities[productId] = 1;
            updateProductDisplay(productId);
            updateBottomBar();
        }

        function increaseQuantity(productId) {
            productQuantities[productId]++;
            updateProductDisplay(productId);
            updateBottomBar();
        }

        function decreaseQuantity(productId) {
            productQuantities[productId]--;
            updateProductDisplay(productId);
            updateBottomBar();
        }

        function updateProductDisplay(productId) {
            const productOption = document.querySelector(`.product-option[data-product="${productId}"]`);
            const addButton = productOption.querySelector('.add-to-cart-button');
            const quantitySelector = productOption.querySelector('.quantity-selector');
            const quantityDisplay = quantitySelector.querySelector('.quantity-display');
            const quantity = productQuantities[productId];

            if (quantity === 0) {
                addButton.classList.remove('hidden');
                quantitySelector.classList.add('hidden');
                productOption.classList.remove('selected');
            } else {
                addButton.classList.add('hidden');
                quantitySelector.classList.remove('hidden');
                quantityDisplay.textContent = quantity;
                productOption.classList.add('selected');
            }
        }

        // ============================================
        // BOTTOM BAR FUNCTIONALITY
        // ============================================

        const bottomBar = document.getElementById('bottom-checkout-bar');

        function getTotalQuantity() {
            return Object.values(productQuantities).reduce((sum, qty) => sum + qty, 0);
        }

        function getSubtotal() {
            let subtotal = 0;
            for (const [productId, quantity] of Object.entries(productQuantities)) {
                if (quantity > 0) {
                    subtotal += PRODUCTS[productId].price * quantity;
                }
            }
            return subtotal;
        }

        function toggleBottomBar(show) {
            bottomBar.classList.toggle('visible', show);
            document.body.classList.toggle('has-bottom-bar', show);
        }

        function updateBottomBar() {
            const totalQuantity = getTotalQuantity();
            const subtotal = getSubtotal();

            if (totalQuantity === 0) {
                toggleBottomBar(false);
                return;
            }

            let productDescriptions = [];
            let priceDescriptions = [];

            for (const [productId, quantity] of Object.entries(productQuantities)) {
                if (quantity > 0) {
                    const product = PRODUCTS[productId];
                    const shortName = productId === 'cards-book-bundle' ? 'Cards + Book' : product.name;
                    productDescriptions.push(shortName);
                    priceDescriptions.push(`${quantity} × $${product.price}`);
                }
            }

            document.getElementById('bar-product-name').textContent = productDescriptions.join(', ');
            document.getElementById('bar-product-price').textContent = priceDescriptions.join(' + ');
            document.getElementById('bar-shipping-cost').textContent = 'Calculated at checkout';
            document.getElementById('bar-total-amount').textContent = `$${subtotal}+`;

            toggleBottomBar(true);
        }

        // Initialize
        updateBottomBar();
    </script>
</body>
</html>