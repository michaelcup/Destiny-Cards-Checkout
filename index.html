<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://js.stripe.com https://m.stripe.network; style-src 'self' 'unsafe-inline' https://m.stripe.network; frame-src 'self' https://js.stripe.com https://m.stripe.network; connect-src 'self' https://api.stripe.com https://m.stripe.network https://api.infusionsoft.com; img-src 'self' data: https:;">
    <title>Destiny Cards - Limited Edition Pre-Order</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://js.stripe.com/v3/"></script>
</head>
<body>
        <div class="header">
            <h1>Destiny Cards</h1>
            <p class="tagline">The Paradox Process in Your Hands</p>
            <p class="subtitle">Limited Edition • 1st Printing • Only 75 Decks Available</p>
        </div>

        <div class="hero-section">
            <h2>What if the next time you're stuck, you had a tool that could shift your entire perspective in minutes?</h2>
            <p>You know that feeling. You're caught in a loop—replaying the same relationship argument, staring at the same career dead-end, feeling the same anxiety about money. Your mind tells the same story on repeat, and you can't seem to find your way out.</p>
            <p class="emphasis">Destiny Cards give you a way out.</p>
            <p>This limited-edition deck puts the power of the Paradox Process directly in your hands. No classes. No sessions. No waiting. Just you, the cards, and a new way of seeing what's in front of you.</p>
        </div>

        <div class="products-section">

            <div class="section-intro">
                <h2>Get your Limited Edition Deck Now!</h2>
                <p>Only 75 available.</p>
            </div>

            <div class="product-option" data-product="cards-only" data-price="20">
                <div class="badge">Limited Quantity</div>
                <div class="product-image">
                    <img src="https://via.placeholder.com/400x300/6b46a0/ffffff?text=Destiny+Cards+Deck" alt="Destiny Cards Deck">
                </div>
                <div class="product-info">
                    <h3>Destiny Cards</h3>
                    <div class="price">$20</div>
                    <ul class="features">
                        <li>Complete 1st Edition Destiny Cards deck</li>
                        <li>25+ Functional Philosophy cards</li>
                        <li>10+ Resourceful State cards</li>
                        <li>Quick-start instruction guide</li>
                        <li>Limited edition collector's item</li>
                    </ul>
                    <!-- This will be the button/quantity selector -->
                    <div class="product-selector">
                        <button class="add-to-cart-button" data-product="cards-only">Add To Cart</button>
                        <div class="quantity-selector hidden" data-product="cards-only">
                            <button class="quantity-btn minus">−</button>
                            <span class="quantity-display">1</span>
                            <button class="quantity-btn plus">+</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="content-section">
            <h2>Two Types of Cards. One Powerful System.</h2>
            <p><strong>Functional Philosophy Cards</strong> offer you 25+ viewpoints that cut through your stuck stories and reveal what you haven't been able to see. These aren't affirmations. They're lenses, ways of looking at your situation that create actual shifts in how you feel and what becomes possible.</p>
            <p><strong>Resourceful State Cards</strong> give you access to the emotional clarity you need to make those shifts real. States like empathy, confidence, gratitude, and courage that move you from fight-flight-freeze into rest-receive-allow.</p>
            <p class="emphasis">When you combine them? You get the worksite. The place where real change happens.</p>
        </div>

        <div class="how-it-works">
            <h2>How It Works:</h2>
            <p class="intro">It's simple. Deceptively simple.</p>
            <ol>
                <li>Identify the issue that's got you stuck</li>
                <li>Pull a Destiny Card</li>
                <li>Pull a Resourceful State Card</li>
                <li>Look at your situation through both lenses</li>
                <li>Notice what shifts</li>
            </ol>
            <p>That's it. No belief required. Just willingness.</p>
            <p>You're not being asked to adopt a new worldview or convince yourself of anything. You're simply using a tool—the same way engineers use imaginary numbers to solve real problems. These cards work whether you believe in them or not.</p>
        </div>

        <div class="differentiation">
            <h2>This Isn't Like Other Card Decks</h2>
            <p>Most oracle or affirmation decks give you pretty words that make you feel good for five minutes. Then you're right back where you started. <span class="emphasis">Destiny Cards are different.</span></p>
            <p>They're built on the Paradox Process. A methodology with over 40 years of proven results with CEOs, award-winning performers, psychologists, and people just like you who were tired of being stuck.</p>
            <p>These cards don't just comfort you. They challenge you. They show you the point of resistance where actual transformation lives and they give you the resourceful state you need to work through it.</p>
        </div>

        <div class="limited-edition-banner">
            <h2>Limited Edition. 1st Edition. Only 75 Decks Available.</h2>
            <p>This is the first printing of Destiny Cards, and we're keeping it small. Once these 75 decks are gone, they're gone.</p>
            <p>Why so few? Because this isn't about mass production. It's about getting a powerful tool into the hands of people who will actually use it. People who are serious about getting out of their own way.</p>
            <p class="emphasis">If you've been doing the work or you're ready to start, this deck belongs with you.</p>
        </div>

        <div class="who-this-is-for">
            <h2>Destiny Cards Are For You If...</h2>
            <ul>
                <li>You're tired of your negative feelings running the show</li>
                <li>You've been stuck on the same issue for too long</li>
                <li>You want a tool that actually works, not just another pretty affirmation</li>
                <li>You're willing to look at your life differently</li>
                <li>You're ready to get out of your own way</li>
                <li>You're already familiar with the Paradox Process (or curious to dive in)</li>
            </ul>
            <p class="emphasis">This deck isn't for everyone. It's for people who want real change, not just temporary relief.</p>
        </div>

        <div class="promise-section">
            <h2>The Paradox Process Promise</h2>
            <p>The mind isn't fixed. The beliefs you have now? They were programmed since childhood to protect a version of you that no longer exists. Those outdated protections are keeping you from the very things you want.</p>
            <p>Destiny Cards give you a way to interrupt those patterns and install new ones. Not through force. Not through repetition. But through perspective shifts that hit at the subconscious level.</p>
            <p class="emphasis">That's what makes the Paradox Process different. And that's why this deck works.</p>
        </div>

        <div class="testimonials">
            <h2>What People Are Saying</h2>
            <div class="testimonial-grid">
                <div class="testimonial">
                    <p class="testimonial-text">[Testimonial will be added here]</p>
                    <p class="testimonial-author">— Coming Soon</p>
                </div>
                <div class="testimonial">
                    <p class="testimonial-text">[Testimonial will be added here]</p>
                    <p class="testimonial-author">— Coming Soon</p>
                </div>
                <div class="testimonial">
                    <p class="testimonial-text">[Testimonial will be added here]</p>
                    <p class="testimonial-author">— Coming Soon</p>
                </div>
            </div>
        </div>
        
        <div class="truth-section">
            <h2>The Truth About Tools</h2>
            <p>You don't have to believe imaginary numbers exist to use them to build bridges and design technology. You just have to be willing to use the tool.</p>
            <p>Destiny Cards work the same way.</p>
            <p>You don't have to believe every philosophy. You don't have to adopt every viewpoint. You just have to be willing to look through the lens and see what shifts.</p>
            <p class="emphasis">That willingness? That's all it takes.</p>
            <p>The question isn't whether this deck can help you. The question is: are you willing to get out of your own way?</p>
            <p class="final-cta"><strong>Only 75 available. Get yours before they're gone.</strong></p>
        </div>

        <div class="footer">
            <p><em>Created by Thomas M. Jones, founder of The Paradox Process. With over 40 years of experience guiding CEOs, award-winning performers, and change-makers toward their dreams, Thomas brings practical tools for transformation that actually work.</em></p>
        </div>

        <!-- Modal Overlay for Checkout -->
        <div class="modal-overlay" id="checkout-modal">
            <div class="modal-container">
                <div class="modal-header">
                    <h2>Complete Your Order</h2>
                    <button class="modal-close" id="close-modal" aria-label="Close modal">×</button>
                </div>
                <div class="modal-body">
                    <form id="checkout-form" class="form-section">
                        <div class="customer-info">
                            <div class="form-group">
                                <label for="first-name">First Name</label>
                                <input type="text" id="first-name" name="firstName" required>
                            </div>
                            <div class="form-group">
                                <label for="last-name">Last Name</label>
                                <input type="text" id="last-name" name="lastName" required>
                            </div>
                            <div class="form-group full-width">
                                <label for="email">Email Address</label>
                                <input type="email" id="email" name="email" required>
                                <small style="color: var(--text-light); font-size: 0.9em; margin-top: 5px;">Order confirmation and updates will be sent to this email</small>
                            </div>
                            <div class="form-group full-width">
                                <div style="display: flex; align-items: flex-start; gap: 10px; margin-top: 15px;">
                                    <input type="checkbox" id="email-consent" name="emailConsent" checked style="margin-top: 4px;">
                                    <label for="email-consent" style="font-weight: normal; margin-bottom: 0; line-height: 1.4;">
                                        I agree to receive email updates about my order and future offerings from The Paradox Process. You can unsubscribe at any time.
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="section-title">Shipping Address</div>
                        
                        <div class="shipping-info">
                            <div class="form-group full-width">
                                <label for="address-line1">Street Address</label>
                                <input type="text" id="address-line1" name="addressLine1" required>
                            </div>
                            <div class="form-group full-width">
                                <label for="address-line2">Apartment, Suite, etc. (optional)</label>
                                <input type="text" id="address-line2" name="addressLine2">
                            </div>
                            <div class="form-group">
                                <label for="city">City</label>
                                <input type="text" id="city" name="city" required>
                            </div>
                            <div class="form-group">
                                <label for="state">State/Province</label>
                                <input type="text" id="state" name="state" required>
                            </div>
                            <div class="form-group">
                                <label for="postal-code">Postal Code</label>
                                <input type="text" id="postal-code" name="postalCode" required>
                            </div>
                            <div class="form-group">
                                <label for="country">Country</label>
                                <select id="country" name="country" required>
                                    <option value="">Select Country</option>
                                    <option value="US" selected>United States</option>
                                    <option value="CA">Canada</option>
                                    <option value="GB">United Kingdom</option>
                                    <option value="AU">Australia</option>
                                    <option value="OTHER">Other</option>
                                </select>
                            </div>
                        </div>

                        <div class="section-title">Payment Information</div>
                        
                        <div class="billing-info">
                            <div class="form-group">
                                <label for="billing-first-name">Cardholder First Name</label>
                                <input type="text" id="billing-first-name" name="billingFirstName" required>
                            </div>
                            <div class="form-group">
                                <label for="billing-last-name">Cardholder Last Name</label>
                                <input type="text" id="billing-last-name" name="billingLastName" required>
                            </div>
                        </div>
                        <div id="card-element">
                            <!-- Stripe card element will be inserted here -->
                        </div>
                        <div class="error-message" id="card-errors"></div>

                        <div class="pricing-summary">
                            <div class="pricing-row">
                                <span>Product:</span>
                                <span id="selected-product">Please add items to your cart</span>
                            </div>
                            <div class="pricing-row">
                                <span>Subtotal:</span>
                                <span id="product-price">$0</span>
                            </div>
                            <div class="pricing-row">
                                <span>Shipping:</span>
                                <span id="shipping-cost">Calculated at checkout</span>
                            </div>
                            <div class="pricing-row total">
                                <span>Total:</span>
                                <span id="total-price">$0</span>
                            </div>
                            <div class="shipping-note">*Shipping costs will be added based on your location</div>
                        </div>

                        <button type="submit" id="submit-button" class="checkout-button" disabled>
                            Complete Order
                        </button>
                    </form>
                </div>
            </div>
        </div>
    <!-- Sticky Bottom Checkout Bar -->
    <div class="bottom-checkout-bar" id="bottom-checkout-bar">
        <div class="checkout-bar-content">
            <div class="checkout-bar-info">
                <div class="checkout-bar-product">
                    <span class="checkout-bar-product-name" id="bar-product-name">Destiny Cards</span>
                    <span class="checkout-bar-product-price" id="bar-product-price">1 × $20</span>
                </div>
                <div class="checkout-bar-shipping">
                    <span class="checkout-bar-shipping-label">Shipping:</span>
                    <span class="checkout-bar-shipping-cost" id="bar-shipping-cost">$5</span>
                </div>
                <div class="checkout-bar-total">
                    <span class="checkout-bar-total-label">Total:</span>
                    <span class="checkout-bar-total-amount" id="bar-total-amount">$25</span>
                </div>
            </div>
            <button class="checkout-bar-button" id="bar-checkout-button">
                Proceed to Checkout
            </button>
        </div>
    </div>
    <script>
        // Product configuration
        const PRODUCTS = {
            'cards-only': {
                name: 'Destiny Cards',
                price: 20,
                description: 'Complete 1st Edition Destiny Cards deck'
            }
        };

        // Quantity tracking - stores quantity for each product
        const productQuantities = {
            'cards-only': 0
        };

        // Note: Shipping will be calculated separately - for now showing base price
        const ESTIMATED_SHIPPING = 5; // This should be calculated based on location
        
        // Stripe publishable key 
        const STRIPE_PUBLIC_KEY = 'pk_test_51S9vybJaTakfgkML3IMec5kLbEDf2K4V5A05cKItlGe8sNggczJwdaKe4JmI9f2RXGI1jlT6GD467vJyYFciSKxC00CLjz8vcM';

        // Initialize
        let stripe, elements, cardElement;

        // Initialize Stripe
        if (STRIPE_PUBLIC_KEY !== 'pk_test_YOUR_STRIPE_KEY_HERE') {
            stripe = Stripe(STRIPE_PUBLIC_KEY);
            elements = stripe.elements();
            cardElement = elements.create('card');
            cardElement.mount('#card-element');
            
            cardElement.on('change', ({error}) => {
                const displayError = document.getElementById('card-errors');
                if (error) {
                    displayError.textContent = error.message;
                    displayError.style.display = 'block';
                } else {
                    displayError.style.display = 'none';
                }
                updateSubmitButton();
            });
        }

        // ============================================
        // MODAL FUNCTIONALITY
        // ============================================

        const modal = document.getElementById('checkout-modal');
        const closeModalBtn = document.getElementById('close-modal');
        const barCheckoutButton = document.getElementById('bar-checkout-button');

        // Open modal
        function openModal() {
            modal.classList.add('active');
            document.body.style.overflow = 'hidden'; // Prevent background scrolling
        }

        // Close modal
        function closeModal() {
            modal.classList.remove('active');
            document.body.style.overflow = ''; // Restore scrolling
        }

        // Handle bottom bar checkout button click
        barCheckoutButton.addEventListener('click', () => {
            openModal();
        });

        // Handle close button click
        closeModalBtn.addEventListener('click', () => {
            closeModal();
        });

        // Close modal when clicking outside the modal container
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                closeModal();
            }
        });

        // Close modal on Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && modal.classList.contains('active')) {
                closeModal();
            }
        });

        // ============================================
        // QUANTITY SELECTOR FUNCTIONALITY
        // ============================================

        // Set up click handlers for "Add to Cart" buttons
        document.querySelectorAll('.add-to-cart-button').forEach(button => {
            button.addEventListener('click', (e) => {
                e.stopPropagation(); // Prevent event bubbling
                const productId = button.dataset.product;
                addToCart(productId);
            });
        });

        // Set up click handlers for quantity buttons
        document.querySelectorAll('.quantity-btn').forEach(button => {
            button.addEventListener('click', (e) => {
                e.stopPropagation(); // Prevent event bubbling
                const productId = button.closest('.quantity-selector').dataset.product;
                
                if (button.classList.contains('plus')) {
                    increaseQuantity(productId);
                } else if (button.classList.contains('minus')) {
                    decreaseQuantity(productId);
                }
            });
        });

        // Add item to cart (transforms button to quantity selector)
        function addToCart(productId) {
            productQuantities[productId] = 1;
            updateProductDisplay(productId);
            updatePricing();
            updateBottomBar();
            updateSubmitButton();
        }

        // Increase quantity
        function increaseQuantity(productId) {
            productQuantities[productId]++;
            updateProductDisplay(productId);
            updatePricing();
            updateBottomBar();
        }

        // Decrease quantity
        function decreaseQuantity(productId) {
            productQuantities[productId]--;
            
            // If quantity is 0, transform back to "Add to Cart" button
            if (productQuantities[productId] === 0) {
                updateProductDisplay(productId);
                updatePricing();
                updateBottomBar();
                updateSubmitButton();
            } else {
                updateProductDisplay(productId);
                updatePricing();
                updateBottomBar();
            }
        }

        // Update the product display (toggle between button and quantity selector)
        function updateProductDisplay(productId) {
            const productOption = document.querySelector(`[data-product="${productId}"]`);
            const addButton = productOption.querySelector('.add-to-cart-button');
            const quantitySelector = productOption.querySelector('.quantity-selector');
            const quantityDisplay = quantitySelector.querySelector('.quantity-display');
            
            const quantity = productQuantities[productId];
            
            if (quantity === 0) {
                // Show "Add to Cart" button, hide quantity selector
                addButton.classList.remove('hidden');
                quantitySelector.classList.add('hidden');
                productOption.classList.remove('selected');
            } else {
                // Hide "Add to Cart" button, show quantity selector
                addButton.classList.add('hidden');
                quantitySelector.classList.remove('hidden');
                quantityDisplay.textContent = quantity;
                productOption.classList.add('selected');
            }
        }

        // ============================================
        // PRICING AND DISPLAY UPDATES
        // ============================================

        // Calculate total quantity across all products
        function getTotalQuantity() {
            return Object.values(productQuantities).reduce((sum, qty) => sum + qty, 0);
        }

        // Calculate total price (subtotal before shipping)
        function getSubtotal() {
            let subtotal = 0;
            for (const [productId, quantity] of Object.entries(productQuantities)) {
                if (quantity > 0) {
                    subtotal += PRODUCTS[productId].price * quantity;
                }
            }
            return subtotal;
        }

        // Update pricing display in checkout form
        function updatePricing() {
            const totalQuantity = getTotalQuantity();
            const subtotal = getSubtotal();
            const total = subtotal + (totalQuantity > 0 ? ESTIMATED_SHIPPING : 0);
            
            if (totalQuantity === 0) {
                document.getElementById('selected-product').textContent = 'Please add items to your cart';
                document.getElementById('product-price').textContent = '$0';
                document.getElementById('shipping-cost').textContent = 'Calculated at checkout';
                document.getElementById('total-price').textContent = '$0';
                return;
            }

            // Build product description
            let productDescription = '';
            for (const [productId, quantity] of Object.entries(productQuantities)) {
                if (quantity > 0) {
                    const product = PRODUCTS[productId];
                    productDescription += `${quantity}× ${product.name}`;
                }
            }
            
            document.getElementById('selected-product').textContent = productDescription;
            document.getElementById('product-price').textContent = `$${subtotal}`;
            document.getElementById('shipping-cost').textContent = `$${ESTIMATED_SHIPPING} (estimated)`;
            document.getElementById('total-price').textContent = `$${total}`;
        }

        // ============================================
        // BOTTOM BAR FUNCTIONALITY
        // ============================================

        const bottomBar = document.getElementById('bottom-checkout-bar');
        
        // Show/hide bottom bar
        function toggleBottomBar(show) {
            if (show) {
                bottomBar.classList.add('visible');
                document.body.classList.add('has-bottom-bar');
            } else {
                bottomBar.classList.remove('visible');
                document.body.classList.remove('has-bottom-bar');
            }
        }
        
        // Update bottom bar content
        function updateBottomBar() {
            const totalQuantity = getTotalQuantity();
            const subtotal = getSubtotal();
            const total = subtotal + (totalQuantity > 0 ? ESTIMATED_SHIPPING : 0);
            
            if (totalQuantity === 0) {
                toggleBottomBar(false);
                return;
            }
            
            // Build product description for bar
            let productDescription = '';
            let priceDescription = '';
            for (const [productId, quantity] of Object.entries(productQuantities)) {
                if (quantity > 0) {
                    const product = PRODUCTS[productId];
                    productDescription = product.name;
                    priceDescription = `${quantity} × $${product.price}`;
                }
            }
            
            document.getElementById('bar-product-name').textContent = productDescription;
            document.getElementById('bar-product-price').textContent = priceDescription;
            document.getElementById('bar-shipping-cost').textContent = `$${ESTIMATED_SHIPPING}`;
            document.getElementById('bar-total-amount').textContent = `$${total}`;
            
            toggleBottomBar(true);
        }

        // ============================================
        // FORM VALIDATION AND SUBMISSION
        // ============================================

        // Update submit button state
        function updateSubmitButton() {
            const submitButton = document.getElementById('submit-button');
            const totalQuantity = getTotalQuantity();
            const hasProducts = totalQuantity > 0;
            const hasCustomerName = document.getElementById('first-name').value && document.getElementById('last-name').value;
            const hasEmail = document.getElementById('email').value;
            const hasAddress = document.getElementById('address-line1').value && 
                              document.getElementById('city').value && 
                              document.getElementById('state').value && 
                              document.getElementById('postal-code').value && 
                              document.getElementById('country').value;
            const hasBillingName = document.getElementById('billing-first-name').value && 
                                  document.getElementById('billing-last-name').value;
            
            submitButton.disabled = !hasProducts || !hasCustomerName || !hasEmail || !hasAddress || !hasBillingName;
        }

        // Form submission with Stripe payment processing
        document.getElementById('checkout-form').addEventListener('submit', async (event) => {
            event.preventDefault();
            
            const totalQuantity = getTotalQuantity();
            if (totalQuantity === 0) {
                alert('Please add items to your cart.');
                return;
            }

            if (STRIPE_PUBLIC_KEY === 'pk_test_YOUR_STRIPE_KEY_HERE') {
                alert('Stripe key not configured. Please add your Stripe publishable key.');
                return;
            }

            const submitButton = document.getElementById('submit-button');
            submitButton.disabled = true;
            submitButton.textContent = 'Processing Payment...';

            // Prepare customer data
            const customerData = {
                firstName: document.getElementById('first-name').value,
                lastName: document.getElementById('last-name').value,
                email: document.getElementById('email').value,
                emailConsent: document.getElementById('email-consent').checked,
                product: 'cards-only', // Since we only have one product
                productName: PRODUCTS['cards-only'].name,
                productPrice: PRODUCTS['cards-only'].price,
                quantity: productQuantities['cards-only'],
                shippingAddress: {
                    line1: document.getElementById('address-line1').value,
                    line2: document.getElementById('address-line2').value,
                    city: document.getElementById('city').value,
                    state: document.getElementById('state').value,
                    postalCode: document.getElementById('postal-code').value,
                    country: document.getElementById('country').value,
                }
            };

            // Prepare billing data
            const billingData = {
                firstName: document.getElementById('billing-first-name').value,
                lastName: document.getElementById('billing-last-name').value,
                email: document.getElementById('email').value,
            };

            const subtotal = getSubtotal();
            const totalAmount = subtotal + ESTIMATED_SHIPPING;

            try {
                // Create payment method with billing information
                const { paymentMethod, error } = await stripe.createPaymentMethod({
                    type: 'card',
                    card: cardElement,
                    billing_details: {
                        name: `${billingData.firstName} ${billingData.lastName}`,
                        email: billingData.email,
                        address: {
                            line1: customerData.shippingAddress.line1,
                            line2: customerData.shippingAddress.line2,
                            city: customerData.shippingAddress.city,
                            state: customerData.shippingAddress.state,
                            postal_code: customerData.shippingAddress.postalCode,
                            country: customerData.shippingAddress.country,
                        }
                    },
                });

                if (error) {
                    throw new Error(error.message);
                }

                // Call Netlify function
                const response = await fetch('/.netlify/functions/process-destiny-cards-payment', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        paymentMethodId: paymentMethod.id,
                        amount: totalAmount,
                        customerData: customerData,
                        billingData: billingData,
                    }),
                });

                const result = await response.json();

                if (result.success) {
                    alert('Payment successful! Your Destiny Cards are on the way. Check your email for confirmation and shipping updates.');
                    
                    // Clear the form and reset quantities
                    document.getElementById('checkout-form').reset();
                    productQuantities['cards-only'] = 0;
                    updateProductDisplay('cards-only');
                    updatePricing();
                    updateBottomBar();
                    
                    // Close the modal
                    closeModal();
                    
                } else {
                    throw new Error(result.message || 'Payment failed');
                }
                
            } catch (error) {
                console.error('Payment error:', error);
                document.getElementById('card-errors').textContent = error.message;
                document.getElementById('card-errors').style.display = 'block';
            }

            submitButton.disabled = false;
            submitButton.textContent = 'Complete Order';
            updateSubmitButton();
        });

        // Add event listeners for form validation
        ['first-name', 'last-name', 'email', 'address-line1', 'city', 'state', 'postal-code', 'country', 'billing-first-name', 'billing-last-name'].forEach(id => {
            document.getElementById(id).addEventListener('input', updateSubmitButton);
            document.getElementById(id).addEventListener('change', updateSubmitButton);
        });

        // Initialize the page
        updatePricing();
        updateBottomBar();
    </script>
</body>
</html>